Lighter 排序器模块对市价单和限价单的处理逻辑有显著不同，这是由其基于中央限价订单簿（CLOB） 的高性能交易模型决定的。简单来说，市价单追求速度，直接参与撮合；而限价单注重价格，需先进入订单簿排队。下面这张图清晰地展示了这两类订单在排序器中的核心处理路径。
flowchart TD
A[订单抵达排序器] --> B{订单类型判断}

    B -- 市价单 --> C[即时撮合通道]
    B -- 限价单 --> D[订单簿管理通道]
    
    C --> E[检查订单簿<br>获取最佳对手价]
    E --> F[立即成交]
    F --> G[生成交易证明]
    
    D --> H[按“价格-时间优先”<br>规则入队列]
    H --> I[等待订单簿中<br>特定价格被触发]
    I --> J[进入撮合引擎]
    J --> G


⚡ 市价单：即时成交的优先级

市价单的核心目标是以当前市场上最优的价格立即成交。因此，Lighter排序器会为其开辟一条“快速通道”。

•   处理逻辑：当排序器收到一笔市价单时，它不会将其放入订单簿排队，而是立刻在订单簿中寻找最优的对手方订单进行匹配。例如，一笔市价买单会直接与订单簿中当前最低的卖单（最佳卖价）成交。

•   优势与风险：这种处理方式的优势是成交速度极快，保证了用户在任何市场情况下都能快速完成交易。但其代价是可能产生滑点：如果订单规模较大，可能会连续吃掉订单簿中的多个档位，最终成交均价可能与提交订单时看到的价格有差异。Lighter通过其高性能架构尽可能降低这种延迟和滑点。

⚙️ 限价单：秩序与耐心的队列

限价单的核心在于控制成本，用户指定了可接受的最高买入价或最低卖出价。排序器会将其作为新的报价纳入市场深度中。

•   处理逻辑：限价单会被排序器添加到订单簿的相应队列中。排序器严格按照 “价格优先、时间优先” 的原则组织队列：价格更优的订单排在前面；价格相同的订单，则按提交时间的先后顺序排列。

•   等待与成交：限价单会一直在订单簿中等待，直到市场价格波动触及其指定的限价水平。例如，一笔限价卖出单只有在市场价格上涨到其指定价格或更高时才会被触发并成交。这也为市场提供了流动性。

💡 核心差异与选择建议

了解这两种订单的区别，能帮助您根据交易策略做出更好选择。

特性 市价单 限价单

成交速度 极快，几乎瞬时 不确定，需等待价格匹配

价格确定性 不确定，存在滑点风险 确定，以指定或更优价格成交

主要目标 快速建仓/平仓，保证成交 精确控制成本，提供流动性

费用 通常作为Taker付费 通常作为Maker返佣或低费率

💎 总结

Lighter的排序器通过差异化的处理逻辑，巧妙地平衡了交易速度和价格控制这两大需求。市价单直通撮合引擎，满足了对时间敏感的用户；而限价单则维护了订单簿的深度和秩序，为希望精确控制交易成本的用户提供了工具。

希望这份解释能帮助您理解Lighter排序器的工作机制。如果您对特定订单类型（如FOK、IOC）或止损单的处理方式有进一步兴趣，我们可以继续探讨。