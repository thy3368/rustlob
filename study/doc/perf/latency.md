# 全球交易所低延迟指标统计

## 时间单位换算

| 单位 | 缩写 | 换算 |
|------|------|------|
| 秒 (Second) | s | 1s |
| 毫秒 (Millisecond) | ms | 1s = 1,000 ms |
| 微秒 (Microsecond) | μs | 1s = 1,000,000 μs |
| 纳秒 (Nanosecond) | ns | 1s = 1,000,000,000 ns |

```
1 ms = 1,000 μs = 1,000,000 ns
1 μs = 1,000 ns
```

---

## 延迟分级标准

| 级别 | 延迟范围 | 典型应用场景 |
|------|----------|-------------|
| 超低延迟 (ULL) | < 1 μs | FPGA 硬件加速、顶级 HFT |
| 极低延迟 | 1-10 μs | 专业 HFT 交易系统 |
| 低延迟 | 10-100 μs | 专业量化交易 |
| 标准延迟 | 100 μs - 1 ms | 机构交易 |
| 普通延迟 | 1-10 ms | 加密货币交易所 |
| 零售延迟 | 10-100 ms | 零售交易平台 |

---

## 全球主要交易所延迟指标

### 北美交易所

| 交易所 | 撮合引擎延迟 | 备注 |
|--------|-------------|------|
| **CME Globex** | 10-50 μs | 期货/期权，FIFO/Pro-Rata 算法 |
| **NYSE Arca** | ~50-100 μs | 股票交易 |
| **NASDAQ** | < 40 μs | INET 平台 (目标竞争延迟) |
| **ICE** | 10-30 μs | 期货/商品 |
| **IEX** | ~350 μs | 故意添加 350μs "减速带" |

### 欧洲交易所

| 交易所 | 撮合引擎延迟 | 备注 |
|--------|-------------|------|
| **Eurex (T7)** | ~2.8 μs (最小) | Deutsche Börse T7 平台 |
| **Eurex** | ~83 μs (订单簿更新) | 交易生成 160+ μs |
| **LSE Millennium** | ~126 μs (往返) | 伦敦证券交易所 |
| **Euronext** | 10-50 μs | 巴黎/阿姆斯特丹 |

### 亚太交易所

| 交易所 | 撮合引擎延迟 | 备注 |
|--------|-------------|------|
| **JPX arrowhead4.0** | ~3 μs (Co-location) | 2024年11月上线 |
| **JPX arrowhead** | ~68 μs (Access Point) | 日本交易所集团 |
| **SGX REACH** | ~90 μs | 新加坡交易所，NASDAQ 技术 |
| **HKEX AMS/3.8** | ~1.4 ms | 香港交易所 (从150ms升级) |
| **上交所 SSE** | 未公开 | Level 2: 3秒快照 |
| **深交所 SZSE** | 未公开 | 与上交所类似架构 |

### 加密货币交易所

| 交易所 | API 延迟 | 备注 |
|--------|----------|------|
| **OKX** | ~3-5 ms | 中位数 3ms，40万 TPS |
| **Binance** | ~5-20 ms | BBA 解析 ~200ns |
| **Coinbase** | ~10-50 ms | 机构级 API |
| **一般加密交易所** | 10-100 ms | 网页架构限制 |

---

## HFT 系统延迟基准

### 软件方案

| 技术栈 | Tick-to-Trade 延迟 |
|--------|-------------------|
| 优化 C++/Rust | 5-10 μs |
| 内核旁路 (DPDK/RDMA) | 3-8 μs |
| Java (低延迟 GC) | 10-50 μs |

### 硬件加速方案

| 技术 | 延迟 |
|------|------|
| **FPGA (Solarflare AOE)** | 750-800 ns |
| **FPGA (AMD Alveo)** | < 20 ns (芯片内部) |
| **ASIC 定制芯片** | < 10 ns |

### 网络延迟

| 组件 | 延迟 |
|------|------|
| 每个网络交换机 | ~100 ns |
| 光纤传输 (每公里) | ~4.9 μs |
| 微波传输 (每公里) | ~3.3 μs |
| Co-location 机房内 | < 1 μs |

---

## 延迟组成分解

### 交易所撮合引擎内部延迟

```
订单生命周期时间戳 (以 Eurex T7 为例):

客户端                     交易所
   │                         │
   │─────── 订单请求 ────────→│ t_3a: 网络入口时间戳
   │                         │ t_3n: 网关网络接收
   │                         │ t_3': 网关处理完成
   │                         │ t_5:  撮合引擎接收
   │                         │ t_7:  撮合处理完成
   │                         │ t_9:  市场数据生成
   │←────── 执行确认 ────────│ t_9d: 市场数据网络出口
   │                         │
```

**Eurex T7 内部延迟测量点:**

| 测量点 | 含义 | 典型延迟 |
|--------|------|---------|
| t_3a | 请求网络入口 (TAP 捕获) | 基准点 |
| t_3a → t_3n | 网络传输到网关 | ~100 ns |
| t_3n → t_3' | 网关请求处理 | ~1-2 μs |
| t_3' → t_5 | 网关到撮合引擎 | ~500 ns |
| t_5 → t_7 | **撮合引擎处理** | ~1-3 μs |
| t_7 → t_9 | 市场数据生成 | ~500 ns |
| t_9 → t_9d | 市场数据网络出口 | ~100 ns |
| **t_3a → t_9d** | **总内部延迟** | **~2.8 μs (最小)** |

**关键指标:**
- 最小延迟 (t_9d - t_3a): **2,787 ns** (~2.8 μs)
- 最快反应时间: **2,754 ns** (理论最小 2,736 ns)
- 网络交换机抖动: 13 ns (5th-95th percentile)
- 时间同步精度: ~1 ns (White Rabbit 技术)

### 撮合引擎处理分解

```
撮合引擎内部处理 (~1.5 μs):
┌────────────────────────────────────────────────────────────────┐
│ 1. 消息解析        │ 100-200 ns │ Binary/FIX 解码             │
├────────────────────────────────────────────────────────────────┤
│ 2. 订单验证        │ 50-100 ns  │ 字段校验、权限检查           │
├────────────────────────────────────────────────────────────────┤
│ 3. 风控检查        │ 100-200 ns │ 持仓限额、价格带检查         │
├────────────────────────────────────────────────────────────────┤
│ 4. 订单簿查询      │ 50-100 ns  │ 价格档位定位 (O(1) 或 O(log n))│
├────────────────────────────────────────────────────────────────┤
│ 5. 撮合匹配        │ 200-500 ns │ FIFO/Pro-Rata 算法执行       │
├────────────────────────────────────────────────────────────────┤
│ 6. 订单簿更新      │ 100-200 ns │ 插入/删除/修改订单           │
├────────────────────────────────────────────────────────────────┤
│ 7. 成交记录        │ 100-200 ns │ Trade 生成、序列号分配        │
├────────────────────────────────────────────────────────────────┤
│ 8. 响应生成        │ 50-100 ns  │ 执行报告编码                 │
└────────────────────────────────────────────────────────────────┘
总计: ~1.0 - 1.5 μs (单线程软件撮合)
```

### 端到端往返延迟 (RTT)

```
RTT_total = RTT_network + Processing_exchange

完整路径:
┌─────────────────────────────────────────────────────────────────┐
│ 客户端                                                          │
│ ├─ 订单生成        │ 100-500 ns │ 策略信号 → 订单对象          │
│ ├─ 消息编码        │ 100-200 ns │ FIX/Binary 序列化            │
│ └─ 网卡发送        │ 500 ns     │ 内核旁路/DPDK               │
├─────────────────────────────────────────────────────────────────┤
│ 网络传输 (Co-location)                                          │
│ ├─ 交换机延迟      │ 100-300 ns │ 每跳 ~100 ns                 │
│ └─ 光纤传输        │ < 100 ns   │ 机房内 < 20m                 │
├─────────────────────────────────────────────────────────────────┤
│ 交易所                                                          │
│ ├─ 网关处理        │ 1-2 μs     │ 协议转换、会话管理           │
│ ├─ 撮合引擎        │ 1-3 μs     │ 订单匹配、订单簿更新         │
│ └─ 响应生成        │ 500 ns     │ 执行报告                    │
├─────────────────────────────────────────────────────────────────┤
│ 返回路径                                                        │
│ └─ 网络 + 客户端   │ 1-2 μs     │ 与发送路径对称               │
└─────────────────────────────────────────────────────────────────┘

Co-location 环境典型 RTT:
- Eurex T7:     ~10-20 μs
- CME Globex:   ~10-50 μs
- NASDAQ:       ~20-40 μs
- LSE:          ~100-150 μs
```

### 交易所行情分发延迟

```
行情数据生命周期:
                      交易所内部                          外部
┌────────────────────────────────────────────┬─────────────────────────┐
│ 撮合引擎 → 行情生成 → 分发层 → 接入层 → │ → 网络 → 客户端接收    │
│   t_7        t_9      t_9a     t_9d       │                         │
└────────────────────────────────────────────┴─────────────────────────┘
```

**行情协议对比:**

| 协议 | 类型 | 解码延迟 | 适用场景 |
|------|------|---------|---------|
| **ITCH** | Binary | ~200-500 ns | NASDAQ 全深度订单簿 |
| **OUCH** | Binary | ~200-400 ns | NASDAQ 订单入口 |
| **SBE** | Binary | ~100-300 ns | CME MDP 3.0, 高效二进制 |
| **FAST** | Compressed | ~500 ns - 2.5 μs | CME 历史，压缩传输 |
| **FIX** | Text | ~5-20 μs | 通用，人类可读 |

**FAST 协议解码延迟:**
- 简单消息 (ARCA-like): < 500 ns
- 复杂消息 (CME-like): < 2.5 μs

**直连行情 vs SIP 延迟对比 (美股):**

| 数据源 | 延迟 | 说明 |
|--------|------|------|
| **Direct Feed** | 1-10 μs | 交易所直连，Co-location |
| **SIP Tape A/B** | ~90 μs | NYSE/AMEX 合并行情 (2018) |
| **SIP Tape C** | ~17 μs | NASDAQ 合并行情 (2018) |
| **SIP 历史** | ~6 ms | 2010年水平 |

**Eurex T7 行情延迟 (EOBI vs ETI):**

| 指标 | EOBI (行情) | ETI (交易) | 差异 |
|------|------------|-----------|------|
| 中位数延迟 | 基准 | +1.5 μs | EOBI 更快 |
| P95 延迟 | 920-1100 ns | - | 订单簿更新 |
| P99 延迟 | ~1600 ns | - | 峰值情况 |
| 数据优先 | 99.99% 先到 | - | 行情先于确认 |

**行情分发架构:**

```
                    ┌─────────────┐
                    │  撮合引擎   │
                    │  (Matcher)  │
                    └──────┬──────┘
                           │ t_7 → t_9
                    ┌──────▼──────┐
                    │  行情生成   │
                    │ (MD Generator)│
                    └──────┬──────┘
                           │
              ┌────────────┼────────────┐
              │            │            │
       ┌──────▼──────┐ ┌───▼───┐ ┌──────▼──────┐
       │   EOBI      │ │ EMDI  │ │    MDI      │
       │ (全深度)    │ │(增量) │ │ (快照)      │
       └──────┬──────┘ └───┬───┘ └──────┬──────┘
              │            │            │
              └────────────┼────────────┘
                           │ Multicast UDP
              ┌────────────┼────────────┐
              │            │            │
       ┌──────▼──────┐ ┌───▼───┐ ┌──────▼──────┐
       │  客户端 A   │ │客户端B│ │  客户端 C   │
       └─────────────┘ └───────┘ └─────────────┘
```

**UDP Multicast 优势:**
- 一对多分发，网络设备复制
- 无 TCP 握手/重传开销
- 适合高频行情推送 (8000+ msg/ms)

### HFT 交易端延迟分解

```
典型 HFT 系统 Tick-to-Trade:
┌─────────────────────────────────────────────────────────────┐
│ 市场数据接收    │ 500 ns  │ 网卡 → 内存 (DMA)              │
├─────────────────────────────────────────────────────────────┤
│ 协议解析        │ 200 ns  │ FAST/SBE/ITCH 解码             │
├─────────────────────────────────────────────────────────────┤
│ 策略计算        │ 1-5 μs  │ 信号生成、定价、风控            │
├─────────────────────────────────────────────────────────────┤
│ 订单编码        │ 100-200 ns │ FIX/Binary 编码              │
├─────────────────────────────────────────────────────────────┤
│ 网络发送        │ 500 ns  │ 内存 → 网卡 (零拷贝)           │
└─────────────────────────────────────────────────────────────┘
总计: 2.4 - 7.5 μs (纯软件方案)
总计: 750-800 ns (FPGA 方案)
```

### 延迟来源占比

```
典型交易系统延迟分布:

软件方案 (5 μs 总延迟):
┌──────────────────────────────────────────────────┐
│ 网络栈      ████████░░░░░░░░░░░░ 40% (~2 μs)    │
│ 策略计算    ██████░░░░░░░░░░░░░░ 30% (~1.5 μs)  │
│ 协议编解码  ████░░░░░░░░░░░░░░░░ 20% (~1 μs)    │
│ 其他开销    ██░░░░░░░░░░░░░░░░░░ 10% (~0.5 μs)  │
└──────────────────────────────────────────────────┘

FPGA 方案 (800 ns 总延迟):
┌──────────────────────────────────────────────────┐
│ 网络 I/O    ██████████░░░░░░░░░░ 50% (~400 ns)  │
│ FPGA 逻辑   ████████░░░░░░░░░░░░ 40% (~300 ns)  │
│ 主机交互    ██░░░░░░░░░░░░░░░░░░ 10% (~100 ns)  │
└──────────────────────────────────────────────────┘
```

---

## 延迟测量方法

### 关键指标

| 指标 | 说明 |
|------|------|
| **Tick-to-Trade** | 收到行情到发出订单 |
| **Round-Trip Time (RTT)** | 订单往返总时间 |
| **P50 / P99 / P99.9** | 百分位延迟 |
| **Jitter** | 延迟波动/抖动 |

### 测量工具

```c
// TSC 高精度计时 (纳秒级)
static inline uint64_t rdtsc() {
    unsigned int lo, hi;
    __asm__ volatile ("rdtsc" : "=a" (lo), "=d" (hi));
    return ((uint64_t)hi << 32) | lo;
}

// 使用方法
uint64_t start = rdtsc();
// ... 被测代码 ...
uint64_t end = rdtsc();
uint64_t cycles = end - start;
// 转换: latency_ns = cycles / (cpu_freq_ghz)
```

```rust
// Rust 高精度计时
use std::time::Instant;

let start = Instant::now();
// ... 被测代码 ...
let elapsed = start.elapsed().as_nanos();
```

---

## 清算与结算 (Clearing & Settlement)

### 结算周期对比

| 地区/市场 | 结算周期 | 生效时间 | 备注 |
|----------|---------|---------|------|
| **美国** | T+1 | 2024年5月28日 | SEC 强制，从 T+2 缩短 |
| **加拿大** | T+1 | 2024年5月 | 与美国同步 |
| **墨西哥** | T+1 | 2024年5月 | 与美国同步 |
| **印度** | T+1 (可选 T+0) | 2023年初 | T+0 Phase 1: 25只股票 |
| **中国** | T+0 | 现行 | 实时结算 |
| **欧盟** | T+1 (计划) | 2027年10月11日 | 当前 T+2 |
| **英国** | T+1 (计划) | 2027年10月11日 | 当前 T+2 |
| **瑞士** | T+1 (计划) | 2027年10月11日 | 当前 T+2 |
| **日本** | T+2 | 现行 | 探索 T+1 |
| **澳大利亚** | T+2 | 现行 | ASX 研究 T+1 |
| **香港** | T+2 | 现行 | - |
| **新加坡** | T+2 | 现行 | 探索实时结算 |

### 结算周期演进

```
历史演进:
T+5 (1990s) → T+3 (2000s) → T+2 (2017) → T+1 (2024) → T+0 (未来)

时间线:
┌─────────────────────────────────────────────────────────────────┐
│ 1995      │ 2017      │ 2023    │ 2024.5  │ 2027.10 │ 未来    │
│ T+5→T+3   │ US T+2    │ India   │ US T+1  │ EU T+1  │ T+0?    │
│           │           │ T+1     │         │         │         │
└─────────────────────────────────────────────────────────────────┘
```

### 主要清算机构 (CCP)

| 机构 | 地区 | 服务市场 | 特点 |
|------|------|---------|------|
| **DTCC/NSCC** | 美国 | 股票、债券 | 日均净额结算效率 98% |
| **CME Clearing** | 美国 | 期货、期权 | SPAN 保证金模型 |
| **OCC** | 美国 | 期权 | 跨保证金计划 |
| **Eurex Clearing** | 欧洲 | 衍生品 | 实时保证金计算 |
| **LCH** | 欧洲 | 利率互换、外汇 | 全球最大利率互换清算 |
| **JSCC** | 日本 | 股票、衍生品 | JPX 集团 |
| **HKCC** | 香港 | 衍生品 | HKEX 集团 |
| **中国结算 CSDC** | 中国 | A股、债券 | T+0/T+1 结算 |

### 清算延迟指标

| 环节 | 延迟 | 说明 |
|------|------|------|
| **交易确认** | 实时 ~ 秒级 | 撮合后即时确认 |
| **清算计算** | 分钟级 | 轧差、保证金计算 |
| **日终清算** | T+0 EOD | 当日交易日终处理 |
| **结算交割** | T+1/T+2 | 资金和证券实际交割 |
| **保证金追缴** | 实时 ~ 日内 | Eurex: 全天候 (0:00-22:00 CET) |

### 实时风控 (Real-Time Risk)

**Eurex Clearing:**
- 衍生品保证金: 实时计算 (每次价格/持仓变化)
- 现货保证金: 每 10 分钟更新
- 日内追保: 全天候 (0:00-22:00 CET)

**CME Clearing:**
- SPAN 保证金模型
- 每日最多 8 次保证金计算周期
- 实时交易数据监控

### 净额结算效率

```
DTCC 净额结算示例 (2020年3月3日):
┌────────────────────────────────────────┐
│ 总交易额:    $3.5 万亿                  │
│ 净额结算后:  $800 亿                    │
│ 结算效率:    98% 减少                   │
└────────────────────────────────────────┘
```

### T+0 实时结算的挑战

| 挑战 | 说明 |
|------|------|
| **流动性需求** | 无法净额结算，需逐笔预付资金 |
| **资金成本** | 预筹资金成本大幅增加 |
| **失败率** | 无缓冲时间，失败交易可能激增 |
| **时区问题** | 跨境交易时区差异 (亚洲比纽约快 13-14 小时) |
| **CCP 角色** | 即时结算可能削弱 CCP 的风险缓释作用 |

### 加密货币结算

| 类型 | 结算时间 | 说明 |
|------|---------|------|
| **交易所内交易** | 即时 | 内部账本记账，无链上交易 |
| **链上提现 (BTC)** | 10-60 分钟 | 取决于网络确认数 |
| **链上提现 (ETH)** | 1-5 分钟 | 取决于 Gas 和确认数 |
| **稳定币 (USDT-TRC20)** | 1-3 分钟 | TRON 网络 |
| **法币提现** | 1-7 天 | 银行 ACH/电汇处理 |

**Binance 提现:**
- 加密货币: 通常 30-60 分钟
- 即时卡提现: 5 分钟 ~ 24 小时
- ACH 存款: 7 天提现锁定期

### 未来技术: DLT 与 CBDC

| 技术 | 潜力 | 现状 |
|------|------|------|
| **DLT/区块链** | 原子结算 (Atomic Settlement) | 试点阶段 |
| **CBDC** | 央行数字货币即时结算 | 多国研发中 |
| **智能合约** | 自动化交割 vs 付款 (DvP) | 概念验证 |

---

## 行业趋势 (2024-2025)

1. **交易所瓶颈**: 交易所内部延迟仍在 10-100 μs 级别，成为主要瓶颈

2. **FPGA 标准化**: FPGA 已成为 HFT 行业标准，将延迟从微秒降至纳秒

3. **亚洲市场增长**: 东京-香港-新加坡低延迟网络需求增加

4. **加密市场**: 加密交易所延迟仍高于传统交易所 100-1000 倍

5. **云端撮合**: AWS/SGX 概念验证显示云撮合可达 100-200 μs

---

## 参考资源

### 交易所官方文档
- [CME Globex Matching Algorithms](https://www.cmegroup.com/education/matching-algorithm-overview.html)
- [Eurex T7 Trading System Dynamics](https://www.eurexchange.com/)
- [JPX arrowhead](https://www.jpx.co.jp/english/systems/equities-trading/01.html)
- [HKEX Trading Infrastructure](https://www.hkex.com.hk/Services/Trading)

### 清算结算
- [DTCC: What You Need to Know About Real-Time Settlement](https://www.dtcc.com/dtcc-connection/articles/2021/february/18/what-you-need-to-know-about-real-time-settlement)
- [DTCC: Accelerated Settlement White Paper](https://www.dtcc.com/-/media/Files/PDFs/White%20Paper/DTCC-Accelerated-Settle-WP-2021.pdf)
- [Eurex Clearing: Margining Process](https://www.eurex.com/ec-en/services/margining/margining-process)
- [CME Clearing: Risk Management](https://www.cmegroup.com/clearing/risk-management.html)
- [QuestDB: Clearing and Settlement Latency](https://questdb.com/glossary/clearing-and-settlement-latency/)
- [Deutsche Bank: Accelerated Settlement – The Move Towards T+0](https://flow.db.com/securities-services/accelerated-settlement-the-move-towards-t-0)
- [BNP Paribas: Global T+1 Outlook](https://securities.cib.bnpparibas/t1-settlement-ready/)

### 行业分析
- [Ultra-low latency trading: How low can you go? - WatersTechnology](https://www.waterstechnology.com/market-access/data/7952118/ultra-low-latency-trading-how-low-can-you-go)
- [Latency Standards in Trading Systems - LuxAlgo](https://www.luxalgo.com/blog/latency-standards-in-trading-systems/)
- [Low latency (capital markets) - Wikipedia](https://en.wikipedia.org/wiki/Low_latency_(capital_markets))

### 技术资源
- [Stack Overflow: How fast is HFT today?](https://stackoverflow.com/questions/17256040/how-fast-is-state-of-the-art-hft-trading-systems-today)
- [Databento: Introduction to Matching Engines](https://databento.com/blog/introduction-matching-engines)
- [CoinAPI: Crypto Trading Latency Guide](https://www.coinapi.io/blog/crypto-trading-latency-guide)

---

*最后更新: 2024年12月*
